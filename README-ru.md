[RU-version](https://github.com/Halacky/eng_data_airflow/blob/main/README-ru.md)

[EN-version](https://github.com/Halacky/eng_data_airflow/blob/main/README-en.md)

# ETL-–ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Ñ–ª–∞–≥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ Apache Airflow

## –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ üìä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Apache Airflow. –†–µ—à–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–∂–µ–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å 10 —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ ‚ú®
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –µ–∂–µ–º–µ—Å—è—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (–∑–∞–ø—É—Å–∫ 5-–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞)
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏
- **–ù–∞–≥–ª—è–¥–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è üõ†Ô∏è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞
```mermaid
graph TD
    A[–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö] --> B[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ü—Ä–æ–¥—É–∫—Ç 1]
    A --> C[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ü—Ä–æ–¥—É–∫—Ç 2]
    A --> D[...]
    A --> E[–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ü—Ä–æ–¥—É–∫—Ç 10]
    B --> F[–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–ª–∞–≥–æ–≤]
    C --> F
    D --> F
    E --> F
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ** (–∏–∑ CSV) ‚Üí 2. **–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è** (—Ä–∞—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏) ‚Üí 3. **–ó–∞–≥—Ä—É–∑–∫–∞** (–≤ CSV)

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã üöÄ

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Docker –∏ Docker Compose
- 4–ì–ë+ —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
./init.sh
```

### –î–æ—Å—Ç—É–ø –∫ Airflow
üåê –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: [http://localhost:8080](http://localhost:8080)

üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: (—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—ã–≤–æ–¥ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –ø–æ—Å–ª–µ init.sh –∏–ª–∏ —Ñ–∞–π–ª .env)

## –î–µ—Ç–∞–ª–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ üîç

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫: **–ï–∂–µ–º–µ—Å—è—á–Ω–æ 5-–≥–æ —á–∏—Å–ª–∞**
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫: –î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow

### –ó–∞–¥–∞—á–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞
| –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º |
|-----------------|----------|-------------|
| `extract_data` | –ß—Ç–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö CSV-–¥–∞–Ω–Ω—ã—Ö | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π |
| `transform_{product}` | –†–∞—Å—á–µ—Ç —Ñ–ª–∞–≥–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ 3 –º–µ—Å—è—Ü–∞ | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π (10 –∑–∞–¥–∞—á) |
| `load_flags` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π |

## –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ üöÄ
- **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∏—Å—Ç–æ—Ä–∏–∏
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é —Å—Ç–∞—Ç—É—Å–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã üìà
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

![–°–∫—Ä–∏–Ω—à–æ—Ç –¥–∞—à–±–æ—Ä–¥–∞ Airflow](https://github.com/user-attachments/assets/85526882-a530-4571-94aa-335c7079430a)

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `flags_activity.csv` —Å–æ —Å—Ç–æ–ª–±—Ü–∞–º–∏:
- ID –∫–ª–∏–µ–Ω—Ç–∞
- –ú–µ—Å—è—Ü-–ì–æ–¥
- –§–ª–∞–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º 1-10 (1=–∞–∫—Ç–∏–≤–µ–Ω, 0=–Ω–µ–∞–∫—Ç–∏–≤–µ–Ω)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π üõ†Ô∏è
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: `docker-compose logs -f`
- –õ–æ–≥–∏ –∑–∞–¥–∞—á –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Airflow
- –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å CSV-—Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---
